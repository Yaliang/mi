ws={init:function(e){this.host="ws://yueme-websocket.herokuapp.com/","undefined"!=typeof e&&0==e.autoconnect||ws.connect()},connect:function(){this.connection=new WebSocket(this.host),this.connection.onopen=function(e){$(document).trigger("ws:ready")},this.connection.onclose=function(e){console.log("WebSocket Reconnecting"),pullNotification=!0,ws.connect()}},login:function(e){var n=e.callback,t=e.errorHandler,o=e.key;if(this.connection.onmessage=function(e){var o=JSON.parse(e.data);"token"==o.type?"undefined"!=typeof o.token?(ws.token=o.token,ws.userid=o.userid,localStorage.ws=JSON.stringify({auth:!0,userid:o.userid,token:o.token,date:o.date}),n(o)):t(o):"notification_message"==o.type&&ws.noti_receiver(o)},"undefined"!=typeof o&&"username"in o&&"password"in o)var i={type:"login",username:o.username,password:o.password,date:Date.now()};else if("ws"in localStorage)if(o=JSON.parse(localStorage.ws),"userid"in o&&"token"in o&&"auth"in o)var i={type:"login",userid:o.userid,token:o.token,date:o.date};else t("incomplete cache keys");else t("no key access");this.connection.send(JSON.stringify(i))},noti_receiver:function(e){("undefined"==typeof this.lastPull||this.lastPull<e.date)&&(this.lastPull=Date.now(),pullNotification())},logout:function(){this.connection.onmessage=void 0,localStorage.removeItem("ws");var e={type:"logout",userid:this.userid,token:this.token};this.connection.send(JSON.stringify(e))}};