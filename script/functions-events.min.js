function addInterestEvent(e){var t=function(e){var t=e.id,i=e.get("owner"),n=0;"undefined"!=typeof e.get("interestId")&&(n=e.get("interestId").length),$(".interest-statistics-"+t).each(function(){$(this).html(n.toString()+" Interests")}),$(".interest-button-"+t).each(function(){var e=t,i=$(this),n="<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-true interest-button-"+e+"' onclick='removeInterestEvent(\""+e+"\")'>Interest</a></div>";i.before(n),i.remove()});var o=e.get("title");o.length>10&&(o=o.slice(0,6)+"..."),pushNotificationToDeviceByUsername(i,Parse.User.current().get("name")+" interested in your activity '"+o+"'.")};ParseAddInterest(e,t)}function removeInterestEvent(e){var t=function(e){var t=e.id,i=0;"undefined"!=typeof e.get("interestId")&&(i=e.get("interestId").length),$(".interest-statistics-"+t).each(function(){$(this).html(i.toString()+" Interests")}),$(".interest-button-"+t).each(function(){var e=t,i=$(this),n="<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-false interest-button-"+e+"' onclick='addInterestEvent(\""+e+"\")'>Interest</a></div>";i.before(n),i.remove()})};ParseRemoveInterest(e,t)}function addGoingEvent(e){var t=(Parse.User.current(),function(e){var t=e.id,i=e.get("owner"),n=0;"undefined"!=typeof e.get("goingId")&&(n=e.get("goingId").length),$(".going-statistics-"+t).each(function(){$(this).html(n.toString()+" Goings")}),$(".going-button-"+t).each(function(){var e=t,i=$(this),n="<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-true going-button-"+e+"' onclick='removeGoingEvent(\""+e+"\")'>Going</a></div>";i.before(n),i.remove()});var o=e.get("title");o.length>10&&(o=o.slice(0,6)+"..."),pushNotificationToDeviceByUsername(i,Parse.User.current().get("name")+" wanna go with you in activity '"+o+"'!")});ParseAddGoing(e,t)}function removeGoingEvent(e){var t=(Parse.User.current(),function(e){var t=e.id,i=0;"undefined"!=typeof e.get("goingId")&&(i=e.get("goingId").length),$(".going-statistics-"+t).each(function(){$(this).html(i.toString()+" Goings")}),$(".going-button-"+t).each(function(){var e=t,i=$(this),n="<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-false going-button-"+e+"' onclick='addGoingEvent(\""+e+"\")'>Going</a></div>";i.before(n),i.remove()})});ParseRemoveGoing(e,t)}function pullUserEventHolderInfo(e,t){var i=function(e,t){var i=e.get("name"),n=e.get("gender"),o=e.id,r=t.elementIdBase;if($("#body-event-"+t.elementIdBase+" > .custom-corners > .ui-bar").click(function(){displayUserProfile(o)}),$("#body-top-bar-event-"+r+"-owner-name").html(i),"undefined"!=typeof n){var s=$("#body-top-bar-event-"+r+"-owner-gender");n?s.css("backgroundImage","url('./content/customicondesign-line-user-black/png/male-white-20.png')").css("backgroundColor","#8970f1"):s.css("backgroundImage","url('./content/customicondesign-line-user-black/png/female1-white-20.png')").css("backgroundColor","#f46f75")}pullLastItem-=1,0==pullLastItem&&($("#body-event-content-list").removeClass("ui-hidden-accessible"),$.mobile.loading("hide"));var a=function(e,t){var i=e.get("profilePhoto120");"undefined"==typeof i&&(i="./content/png/Taylor-Swift.png"),$("#body-event-"+t.elementIdBase+" > .custom-corners").css("backgroundImage","url('"+i+"')"),pullLastItem-=1,0==pullLastItem&&($("#body-event-content-list").removeClass("ui-hidden-accessible"),$.mobile.loading("hide"))};CacheGetProfilePhotoByUserId(o,a,t)};CacheGetProfileByUsername(e,i,{elementIdBase:t})}function buildUserEventElement(e){var t=e.get("title"),i=e.get("location"),n=e.get("time"),o=(e.get("visibility"),e.get("description")),r=e.get("commentNumber"),s=(e.get("owner"),e.id),a=e.get("goingId");"undefined"==typeof a&&(a=[]);var d=a.length,c=e.get("interestId");"undefined"==typeof c&&(c=[]);var l=c.length,u="";return u=u+"<div id='body-event-"+s+"'>",u+="<div class='custom-corners-public custom-corners'>",u+="<div class='ui-bar ui-bar-a' style='cursor:pointer' onclick=\"$.mobile.changePage('#page-display-user-profile');\">",u=u+"<div><strong id='body-top-bar-event-"+s+"-owner-name'></strong></div>",u=u+"<div id='body-top-bar-event-"+s+"-owner-gender' class='ui-icon-custom-gender'></div>",u+="</div>",u=u+"<div class='ui-body ui-body-a' style='cursor:pointer' onclick=\"$.mobile.changePage('#page-event-detail');updateEventDetail('"+s+"')\">",u=u+"<p class='ui-custom-event-title'>"+t+"</p>",0==o.length?u+="<p class='ui-custom-event-description-less-margin'></br></p>":u=u+"<p class='ui-custom-event-description'>"+o.replace("\n","</br>")+"</p>",u=u+"<p class='ui-custom-event-location'>"+i+"</p>",u=u+"<p class='ui-custom-event-time'>"+n+"</p>",u=u+"<div class='event-statistics comment-statistics-"+s+"' style='clear:both'>"+r+" Comments</div><div class='event-statistics interest-statistics-"+s+"'>"+l+" Interests</div><div class='event-statistics going-statistics-"+s+"'>"+d+" Goings</div>",u+="</div>",u+="<div class='ui-footer ui-bar-custom'>",u=u+"<div class='ui-custom-float-left'><a href='#page-event-detail' data-transition='slide' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-comment' id='comment-button-"+s+"' onclick=\"updateEventDetail('"+s+"')\">Detail</a></div>",u+=c.indexOf(Parse.User.current().id)<0?"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-false interest-button-"+s+"' onclick='addInterestEvent(\""+s+"\")'>Interest</a></div>":"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-true interest-button-"+s+"' onclick='removeInterestEvent(\""+s+"\")'>Interest</a></div>",u=a.indexOf(Parse.User.current().id)<0?u+"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-false going-button-"+s+"' onclick='addGoingEvent(\""+s+"\")'>Going</a></div>":u+"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-true going-button-"+s+"' onclick='removeGoingEvent(\""+s+"\")'>Going</a></div>",u+="</div>",u+="</div>",u+="</div>"}function buildUserProfileDetailElement(e){var t=e.get("name"),i=e.get("gender"),n=e.get("birthdate"),o=e.get("school"),r=e.get("interest"),s=e.get("location"),a=e.get("motto"),d=e.get("major"),c="";return c+="<div class='ui-user-profile-name'>"+t+"</div>",c+="<div class='ui-icon-custom-gender ui-user-profile-gender' style='","undefined"!=typeof i&&(i?(c+="background-image:url(./content/customicondesign-line-user-black/png/male-white-20.png);",c+="background-color:#8970f1;"):(c+="background-image:url(./content/customicondesign-line-user-black/png/female1-white-20.png);",c+="background-color:#f46f75;")),c+="'></div>","undefined"!=typeof n&&n&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Birthday</div><div class='ui-profile-item'>"+n+"</div></div>"),"undefined"!=typeof s&&s&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Region</div><div class='ui-profile-item'>"+s+"</div></div>"),"undefined"!=typeof o&&o&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Education</div><div class='ui-profile-item'>"+o+"</div></div>"),"undefined"!=typeof d&&d&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Major</div><div class='ui-profile-item'>"+d+"</div></div>"),"undefined"!=typeof r&&r&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Interest</div><div class='ui-profile-item'>"+r+"</div></div>"),"undefined"!=typeof a&&a&&(c+="<div class='ui-user-profile-list'><div class='ui-profile-label'>Motto</div><div class='ui-profile-item'>"+a+"</div></div>"),c+="<br>",c+="<div class='ui-btn' id='body-bottom-button-send-request' style='clear: both'></div>",c+="<br>"}function displayUserProfile(e){$("#body-user-profile").html("<div id='body-user-photo-"+e+"' class='ui-user-profile-photo'></div>");var t=function(t,i){$("#body-user-photo-"+i.userId).after(buildUserProfileDetailElement(t));var n=function(e,t,i){if(e!==t)if("undefined"==typeof i){var n=function(e,t,i){"undefined"==typeof i?$("#body-bottom-button-send-request").html("Send Friend Request").on("click",function(){sendFriendRequest(e)}):($("#body-bottom-button-send-request").after("<div class='ui-btn' id='body-bottom-button-response-request-accept' style='clear: both'></div><div class='ui-btn' id='body-bottom-button-response-request-reject' style='clear: both'></div>").remove(),$("#body-bottom-button-response-request-accept").html("Accept Request").on("click",function(){acceptFriendRequest(i.id)}),$("#body-bottom-button-response-request-reject").html("Reject Request").on("click",function(){rejectFriendRequest(i.id,e)}))};CacheCheckFriend(e,t,n)}else{var o=i.get("valid");o?$("#body-bottom-button-send-request").html("Start Chat").on("click",function(){startPrivateChat(t)}):$("#body-bottom-button-send-request").html("Friend Request Sent")}else $("#body-bottom-button-send-request").hide(),$("#body-bottom-button-report-abuse").hide()};CacheCheckFriend(e,Parse.User.current().id,n)};CacheGetProfileByUserId(e,t,{userId:e}),t=function(e,t){var i=e.get("profilePhoto120"),n=e.get("profilePhoto");"undefined"==typeof i&&(i="./content/png/Taylor-Swift.png"),"undefined"==typeof n&&(n="./content/png/Taylor-Swift-300.png"),$("#body-user-photo-"+t.userId).html("<img src='"+i+"' height='100' width='100' style='border-radius: 3px;' onclick='$(\".ui-black-cover\").fadeIn();$(\"#body-user-profile-full-screen-photo\").fadeIn();'>");var o="<div class='ui-black-cover' style='display:none; position:fixed; width:100%; height:100%; opacity:1; background-color:#000; z-index:1001' onclick='$(\".ui-black-cover\").fadeOut();$(\"#body-user-profile-full-screen-photo\").fadeOut();'><div>";o+="<img src='"+n+"' style='max-height:100%; max-width:100%; height:auto; width:auto; position:absolute; top:-50%; bottom:-50%; left:-50%; right:-50%; margin:auto;' onclick='$(\".ui-black-cover\").fadeOut();$(\"#body-user-profile-full-screen-photo\").fadeOut();'>",$("#body-user-profile-full-screen-photo").html(o)},CacheGetProfilePhotoByUserId(e,t,{userId:e})}function pullUserEvent(e,t){currentLastEvent=new Date,pullLastItem=-1;var i=15,n="createdAt";"undefined"==typeof e&&($("#body-event-content-list").addClass("ui-hidden-accessible"),setTimeout(function(){0!=pullLastItem&&$.mobile.loading("show")},350));var o=function(e){var t=Parse.User.current();t.getUsername();pullLastItem=2*e.length,e.length<i&&$(".ui-load-more-activity").html("No More Activities");for(var n=0;n<=e.length-1;n++)if(Date.parse(currentLastEvent)>Date.parse(e[n].createdAt)&&(currentLastEvent=e[n].createdAt),0==$("#body-event-"+e[n].id).length){var o=e[n].id,r=e[n].get("owner"),s=buildUserEventElement(e[n]);$(".ui-load-more-activity").before(s),pullUserEventHolderInfo(r,o)}else{var a=e[n].get("commentNumber"),d=e[n].get("goingId");"undefined"==typeof d&&(d=[]);var c=d.length,l=e[n].get("interestId");"undefined"==typeof l&&(l=[]);var u=l.length;r=e[n].get("owner"),o=e[n].id,$(".comment-statistics-"+o).each(function(){$(this).html(a.toString()+" Comments")}),$(".interest-statistics-"+o).each(function(){$(this).html(u.toString()+" Interests")}),$(".going-statistics-"+o).each(function(){$(this).html(c.toString()+" Goings")}),pullUserEventHolderInfo(r,o)}},r={limitNumber:i,descendingOrderKey:n,accessibility:"public",beforeAt:e,filterMode:t,currentTimeInMilliseconds:(new Date).getTime(),displayFunction:o};navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){r.currentLocation=[e.coords.latitude,e.coords.longitude]}),ParsePullEvent(r)}function insertDescriptionPreviewPhoto(){var e=$("#body-input-insert-description-photo")[0],t=e.files[0];if("undefined"!=typeof t){imgArray.push({file:t});var i=new FileReader;i.onload=function(e){var t=imgArray.length-1,i=$("#body-input-create-event-description").val();$("#body-input-create-event-description").val(i+"\n");var n=$("#body-input-create-event-description").textareaHelper("caretPos"),o=$("#body-input-create-event-description").offset(),r=new Image;r.src=e.target.result;var s=r.width,a=r.height,d=s/a;s=$("#body-input-create-event-description").width()/2,a=s/d,i=$("#body-input-create-event-description").val();var c=a/22-1;$("#body-input-create-event-description").val(i+"<<>>IIIIMMMMMGGGG<<>>"+t.toString()+"\n");for(var l=c;l>0;l--)i=$("#body-input-create-event-description").val(),$("#body-input-create-event-description").val(i+"\n");$("#body-input-create-event-description").textareaHelper("caretPos");$("body").append("<img id='body-description-img"+t.toString()+"' src='"+r.src+"' width='"+s+"' height='"+a+"'>"),$("#body-description-img"+t.toString()).offset({top:n.top+o.top,left:o.left+8});var u=imgArray[t];u.width=s,u.height=a,u.top=n.top,u.left=n.left;$("#body-input-insert-description-photo").val("").clone(!0);$("#body-input-create-event-description").trigger(jQuery.Event("keyup",{keyCode:$.ui.keyCode.ENTER,which:$.ui.keyCode.ENTER})),$("#body-input-create-event-description").textareaHelper("destroy")},i.readAsDataURL(t)}}function deleteDescriptionPreviewPhoto(e){listenKeyup=!1;var t=imgArray.length-1;if(0>t)return void(listenKeyup=!0);var i=$("#body-input-create-event-description"),n=i.textareaHelper("caretPos"),o=imgArray[t],r=o.top+o.height,s=o.left+o.width;if(1==goingToDelete&&8==e.which){console.log("keycode space"),d=i.val();var a=d.indexOf("\n<<>>IIIIMMMMMGGGG<<>>"+t.toString());return i.val(d.substring(0,a)),$("#body-description-img"+t.toString()).remove(),imgArray.pop(),goingToDelete=!1,i.textareaHelper("destroy"),void(listenKeyup=!0)}for(;;){if(console.log("in while"),!(n.left<s&&n.top<=r)){console.log(goingToDelete);break}var d=i.val();i.val(d+" "),i.keyup(),n=i.textareaHelper("caretPos"),goingToDelete=!0}i.textareaHelper("destroy"),listenKeyup=!0}function displayEventMoreOption(){var e=$("#header-create-new-event-option"),t=$("#header-list-my-event-option");e.unbind("click"),t.unbind("click"),$("#header-event-more-option").removeClass("ui-header-more-option").addClass("ui-header-more-option-active"),$(window).unbind("scroll"),e.on("click",function(){var e=new Date,t=e.toISOString().split(":"),i=t[0].split("T"),n=e.getHours();i[1]=10>n?"0"+n:n,time=i[0]+"T"+i[1]+":"+t[1],$("#body-input-create-event-startTime").val(time),$("#body-input-create-event-endTime").val(time),$("#body-bottom-create-event-btn").on("click",function(){createUserEvent()}),hiddenEventMoreOption()}),t.on("click",function(){pullMyEvent(),hiddenEventMoreOption()});var i=$(".options-hidden-cover-layer");i.show(),$(".page-right-top-options").fadeIn("fast"),i.on("click",hiddenEventMoreOption).on("swipeleft",hiddenEventMoreOption).on("swiperight",hiddenEventMoreOption),$(window).scroll(hiddenEventMoreOption)}function hiddenEventMoreOption(){$("#header-create-new-event-option").unbind("click"),$("#header-list-my-event-option").unbind("click"),$("#header-event-more-option").removeClass("ui-header-more-option-active").addClass("ui-header-more-option"),$(window).unbind("scroll"),$(".options-hidden-cover-layer").hide(),$(".page-right-top-options").fadeOut("fast")}function displayEventFilterModeMoreOption(){var e=$("#body-bottom-hiding-event-filter-more-option");e.css("position","fixed").css("bottom",(-e.height()).toString()+"px").show(),$("body").append("<div class='ui-gray-cover' style='position:fixed; width:100%; height:100%; opacity:0; background-color:#000; z-index:1001' onclick='hiddenEventFilterModeMoreOption()'><div>"),e.animate({bottom:"0px"},300),$(".ui-gray-cover").animate({opacity:.15},300)}function hiddenEventFilterModeMoreOption(){var e=$("#body-bottom-hiding-event-filter-more-option");e.animate({bottom:(-e.height()).toString()+"px"},300,function(){e.hide()}),$(".ui-gray-cover").animate({opacity:0},300,function(){$(".ui-gray-cover").remove()})}function createUserEvent(){var e=Parse.User.current(),t=e.getUsername(),i=$("#body-input-create-event-title").val(),n=$("#body-input-create-event-location").val(),o=$("#body-input-create-event-startTime").val().replace("T"," "),r=$("#body-input-create-event-endTime").val().replace("T"," "),s=new Date($("#body-input-create-event-startTime").val()).getTime(),a=new Date($("#body-input-create-event-endTime").val()).getTime(),d=function(e){var t=$("#body-input-create-event-"+e);t.focus().parent().addClass("ui-custom-event-create-focus"),0==$("#body-input-create-event-"+e+"-alert").length&&t.parent().after("<p id='body-input-create-event-"+e+"-alert' class='event-create-alert'>*Field required</p>"),setTimeout(function(){t.focus().parent().removeClass("ui-custom-event-create-focus")},500),t.change(function(){$("#body-input-create-event-"+e+"-alert").remove(),t.unbind("change")})};if(0==i.length)return void d("title");if(0==n.length)return void d("location");if(0==o.length)return void d("startTime");if(0==r.length)return void d("endTime");$("#body-bottom-create-event-btn").unbind("click");var c=o.indexOf(":"),l=o.lastIndexOf(":");c!=l&&(o=o.substring(0,l)),c=r.indexOf(":"),l=r.lastIndexOf(":"),c!=l&&(r=r.substring(0,l));var u=o+" -- "+r,v="on"==$("#body-input-create-event-visibility").val(),m=$("#body-input-create-event-description").val(),p=$("#body-create-event-error"),g="#page-event",f=function(e){$("#body-input-create-event-title").val(""),$("#body-input-create-event-location").val(""),$("#body-input-create-event-startTime").val(""),$("#body-input-create-event-endTime").val(""),$("#body-input-create-event-description").val(""),$("#body-input-create-event-visibility").val("on").flipswitch("refresh"),$("#body-create-event-error").html("");var t=e.id,i=e.get("owner"),n=buildUserEventElement(e);$("#body-event-content-list").prepend(n),pullUserEventHolderInfo(i,t)};ParseEventCreate(t,i,n,u,s,a,v,m,p,g,f)}function buildCommentInEventDetail(e){var t=e.id,i=e.get("ownerName"),n=e.get("content"),o=e.createdAt,r="";return r+="<div id='comment-"+t+"' class='ui-custom-comment-left' onclick='replyCommentToUser({id:\""+e.get("owner")+'", name:"'+i+"\"})'>",r+="<div class='ui-comment-owner'>"+i+"</div>",r+="<div class='ui-comment-time'>"+convertTime(o)+"</div>",r+="<div class='ui-footer-bar-input-comment-content'>"+n+"</div>",r+="</div>"}function buildEventDetailElement(e){var t=e.get("title"),i=e.get("location"),n=e.get("time"),o=(e.get("visibility"),e.get("description")),r=e.get("commentNumber"),s=(e.get("owner"),e.get("goingId"));"undefined"==typeof s&&(s=[]);var a=s.length,d=e.get("interestId");"undefined"==typeof d&&(d=[]);var c=d.length,l=e.id,u="";return u=u+"<div id='body-event-detail-"+l+"'>",u+="<div class='custom-corners-public custom-corners'>",u+="<div class='ui-bar ui-bar-a' style='cursor:pointer' onclick=\"$.mobile.changePage('#page-display-user-profile');\">",u=u+"<div><strong id='body-top-bar-event-detail-"+l+"-owner-name'></strong></div>",u=u+"<div id='body-top-bar-event-detail-"+l+"-owner-gender' class='ui-icon-custom-gender'></div>",u+="</div>",u+="<div class='ui-body ui-body-a'>",u=u+"<p class='ui-custom-event-title'>"+t+"</p>",0==o.length?u+="<p class='ui-custom-event-description-less-margin'></br></p>":u=u+"<p class='ui-custom-event-description'>"+o.replace("\n","</br>")+"</p>",u=u+"<p class='ui-custom-event-location'>"+i+"</p>",u=u+"<p class='ui-custom-event-time'>"+n+"</p>",u=u+"<div class='event-statistics comment-statistics-"+l+"' style='clear:both'>"+r+" Comments</div><div class='event-statistics interest-statistics-"+l+"'>"+c+" Interests</div><div class='event-statistics going-statistics-"+l+"'>"+a+" Goings</div>",u+="</div>",u+="<div class='ui-footer ui-bar-custom'>",u+=d.indexOf(Parse.User.current().id)<0?"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-false interest-button-"+l+"' onclick='addInterestEvent(\""+l+"\")'>Interest</a></div>":"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-true interest-button-"+l+"' onclick='removeInterestEvent(\""+l+"\")'>Interest</a></div>",u=s.indexOf(Parse.User.current().id)<0?u+"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-false going-button-"+l+"' onclick='addGoingEvent(\""+l+"\")'>Going</a></div>":u+"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-true going-button-"+l+"' onclick='removeGoingEvent(\""+l+"\")'>Going</a></div>",u+="</div>",u+="</div>",u+="</div>"}function updateEventDetail(e){currentEarliestComment=new Date,$("#body-content-event-detail").html(""),$("#footer-bar-event-id-label").html(e);var t="createdAt",i=5,n=function(e){shareEvents(e[0]);var t=e[0].id,i=e[0].get("owner"),n=e[0].get("commentNumber"),o=buildEventDetailElement(e[0]);n>5&&(o+="<div class='ui-custom-earlier-comment-btn ui-btn' onclick='loadMoreEventComment()'><font style='font-weight:bold'>load more comments</font></div>"),$("#body-content-event-detail").prepend(o),pullUserEventHolderInfo(i,"detail-"+t),$(".ui-custom-report").on("click",function(){reportActivity(t)})};ParseSelectEvent(e,n),n=function(e){$("#body-content-event-detail").append("<div id='body-content-bottom-event-comments-list' class='ui-custom-comment-container'></div>");for(var t=0;t<=e.length-1;t++){Date.parse(currentEarliestComment)>Date.parse(e[t].createdAt)&&(currentEarliestComment=e[t].createdAt);var i=buildCommentInEventDetail(e[t]);$("#body-content-bottom-event-comments-list").prepend(i);var n=function(e,t){var i=e.get("profilePhoto120");"undefined"==typeof i&&(i="./content/png/Taylor-Swift.png"),$("#comment-"+t.commentId).css("backgroundImage","url("+i+")")};CacheGetProfilePhotoByUserId(e[t].get("owner"),n,{commentId:e[t].id})}},ParsePullEventComment({eventId:e,descendingOrderKey:t,limitNumber:i,displayFunction:n})}function loadMoreEventComment(){var e=$("#footer-bar-event-id-label").html(),t="createdAt",i=10,n=function(e){e.length<10&&($(".ui-custom-earlier-comment-btn").children().html("no more comments"),setTimeout(function(){$(".ui-custom-earlier-comment-btn").animate({opacity:0,height:0},{duration:300,complete:function(){$(".ui-custom-earlier-comment-btn").remove()}})},1e3));for(var t=0;t<=e.length-1;t++){Date.parse(currentEarliestComment)>Date.parse(e[t].createdAt)&&(currentEarliestComment=e[t].createdAt);var i=buildCommentInEventDetail(e[t]);$("#body-content-bottom-event-comments-list").prepend(i);var n=function(e,t){var i=e.get("profilePhoto120");"undefined"==typeof i&&(i="./content/png/Taylor-Swift.png"),$("#comment-"+t.commentId).css("backgroundImage","url("+i+")")};CacheGetProfilePhotoByUserId(e[t].get("owner"),n,{commentId:e[t].id})}};ParsePullEventComment({eventId:e,descendingOrderKey:t,limitNumber:i,beforeAt:currentEarliestComment,displayFunction:n})}function displayEventDetailMoreOption(){$("#header-event-detail-more-option").removeClass("ui-header-more-option").addClass("ui-header-more-option-active");var e=$("#body-bottom-event-detail-more-option");e.css("position","fixed").css("bottom",(-e.height()).toString()+"px").show(),$("body").append("<div class='ui-gray-cover' style='position:fixed; width:100%; height:100%; opacity:0; background-color:#000; z-index:4' onclick='hideEventDetailMoreOption()'><div>"),e.animate({bottom:"0px"},300),$(".ui-gray-cover").animate({opacity:.2},300)}function hideEventDetailMoreOption(){$("#header-event-detail-more-option").addClass("ui-header-more-option").removeClass("ui-header-more-option-active");var e=$("#body-bottom-event-detail-more-option");e.animate({bottom:(-e.height()).toString()+"px"},300,function(){e.hide()}),$(".ui-gray-cover").animate({opacity:0},300,function(){$(".ui-gray-cover").remove()})}function replyCommentToUser(e){$("#footer-bar-reply-to-id-label").html(e.id),$("#footer-bar-input-comment-content").attr("placeholder","@"+e.name),$("#footer-bar-form-comment > .custom-block-a").click()}function sendComment(){var e=$("#footer-bar-event-id-label").html(),t=$("#footer-bar-reply-to-id-label").html();"undefined"==typeof t&&(t="");var i=$("#footer-bar-input-comment-content"),n=i.attr("placeholder"),o=Parse.User.current(),r=o.id,s=i.val();if(""!=s&&(t.length>0&&(s=n+"  "+s),i.val(""),0!=s.length)){var a=function(e){$.mobile.loading("show",{text:e,textVisible:!0,theme:"a",textonly:!0,html:""}),setTimeout(function(){$.mobile.loading("hide")},2e3)},d=function(e,t){var i=e.id,n=e.get("owner"),o=t.replyToUserId,r=e.get("commentNumber");$(".comment-statistics-"+i).each(function(){$(this).html(r.toString()+" Comments")});var s=e.get("title");s.length>10&&(s=s.slice(0,6)+"..."),"undefined"!=typeof o&&null!=o&&pushNotificationToDeviceByUserId(o,Parse.User.current().get("name")+" replied your comment on activity '"+s+"'.");var a=function(e,t){0!=e.id.localeCompare(t.replyToUserId)&&pushNotificationToDeviceByUserId(e.id,Parse.User.current().get("name")+" commented on your activity '"+s+"'.")};CacheGetProfileByUsername(n,a,{replyToUserId:o})};0==t.length&&(t=null);var c=function(e){Date.parse(currentEarliestComment)>Date.parse(e.createdAt)&&(currentEarliestComment=e.createdAt);var t=buildCommentInEventDetail(e);$("#body-content-bottom-event-comments-list").append(t);var i=function(e,t){var i=e.get("profilePhoto120");"undefined"==typeof i&&(i="./content/png/Taylor-Swift.png"),$("#comment-"+t.commentId).css("backgroundImage","url("+i+")")};CacheGetProfilePhotoByUserId(e.get("owner"),i,{commentId:e.id}),$("#footer-bar-input-comment-content").blur()};ParseAddEventComment(e,r,s,{displayNewComment:c,replyToUserId:t,errorFunction:a,successFunction:d})}}function reportActivity(e){var t=function(e){var t=e.id;$("#body-event-"+t).remove(),$.mobile.changePage("#page-event")};ParseUpdateReport(e,t)}function buildMyUserEventElement(e){var t=(e.get("owner"),e.get("title")),i=e.get("location"),n=e.get("time"),o=(e.get("visibility"),e.get("description")),r=0;"undefined"!=typeof e.get("interestId")&&(r=e.get("interestId").length);var s=e.get("commentNumber"),a=e.get("goingId");"undefined"==typeof a&&(a=[]);var d=a.length,c=e.id,l="";return l+="<div id='body-my-event-"+c+"'>",l+="<div class='custom-corners custom-corners-public'>",l+="<div class='ui-body ui-body-a' style='border-top-width: 0; margin-top: 0;'>",l+="<p class='ui-custom-event-title'>"+t+"</p>",i.length>0&&(l+="<p class='ui-custom-event-location'>"+i+"</p>"),n.length>0&&(l+="<p class='ui-custom-event-time'>"+n+"</p>"),l+=0==i.length&&0==n.length?"<p class='ui-custom-event-description-less-margin'>"+o.replace("\n","</br>")+"</p>":"<p class='ui-custom-event-description'>"+o.replace("\n","</br>")+"</p>",l+="<div class='event-statistics comment-statistics-"+c+"'>"+s+" Comments</div><div class='event-statistics interest-statistics-"+c+"'>"+r+" Interests</div><div class='event-statistics going-statistics-"+c+"'>"+d+" Goings</div>",l+="</div>",l+="<div class='ui-footer ui-bar-custom'>",l+="<div class='ui-custom-float-left'><a href='#page-event-detail' data-transition='slide' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-comment' id='my-comment-button-"+c+"' onclick=\"updateEventDetail('"+c+"'); setCurrLocationHash('#page-event-delete')\">Detail</a></div>",l+="<div class='ui-custom-float-left'><a href='#page-event-delete' data-transition='slideup' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-delete' id='my-comment-button-"+c+"' onclick=\"deleteMyEvent('"+c+"'); setCurrLocationHash('#page-event-delete')\">Delete</a></div>",l+="<div class='ui-custom-float-left'><a href='#page-edit-event' data-transition='slide' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-edit' id='my-comment-button-"+c+"' onclick=\"editMyEvent('"+c+"'); setCurrLocationHash('#page-event-delete')\">Edit</a></div>",l+="</div>",l+="</div>",l+="</div>"}function pullMyEvent(e){var t=Parse.User.current(),i=t.getUsername(),n="createdAt",o=function(e){for(var t=e.length-1;t>=0;t--)if(0==$("#body-my-event-list > #body-my-event-"+e[t].id).length)$("#body-my-event-list").prepend(buildMyUserEventElement(e[t]));else{var i=e[t].get("commentNumber"),n=0;"undefined"!=typeof e[t].get("interestId")&&(n=e[t].get("interestId").length);var o=e[t].get("goingId");"undefined"==typeof o&&(o=[]);var r=o.length,s=e[t].id;$(".comment-statistics-"+s).each(function(){$(this).html(i.toString()+" Comments")}),$(".interest-statistics-"+s).each(function(){$(this).html(n.toString()+" Interests")}),$(".going-statistics-"+s).each(function(){$(this).html(r.toString()+" Goings")})}};ParsePullEvent({owner:i,descendingOrderKey:n,beforeAt:e,displayFunction:o})}function deleteMyEvent(e){$(".ui-custom-delete-confirm").click(function(){var t=function(e){$("#body-my-event-"+e).slideUp("fast",function(){$("#body-event-"+e).remove(),$("#body-my-event-"+e).remove()})};ParseDeleteEvent(e,t)})}function editMyEvent(e){var t=function(t){$("#body-input-edit-event-title").val(t[0].get("title")),$("#body-input-edit-event-location").val(t[0].get("location"));var i=t[0].get("time").split(" -- ");$("#body-input-edit-event-startTime").val(i[0].replace(" ","T")),$("#body-input-edit-event-endTime").val(i[1].replace(" ","T")),0==t[0].get("visibility")&&$("#body-select-edit-event-visibility").val("Friends"),$("#body-input-edit-event-description").val(t[0].get("description")),$("#body-bottom-edit-event-save").on("click",function(){editSaveUserEvent(e)})};ParsePullEvent({eventId:e,displayFunction:t})}function editSaveUserEvent(e){var t=Parse.User.current(),i=t.getUsername(),n=$("#body-input-edit-event-title").val(),o=$("#body-input-edit-event-location").val(),r=$("#body-input-edit-event-startTime").val().replace("T"," "),s=$("#body-input-edit-event-endTime").val().replace("T"," "),a=new Date($("#body-input-edit-event-startTime").val()).getTime(),d=new Date($("#body-input-edit-event-endTime").val()).getTime(),c=function(e){var t=$("#body-input-event-edit-"+e);t.focus().parent().addClass("ui-custom-event-edit-focus"),0==$("#body-input-event-edit-"+e+"-alert").length&&t.parent().after("<p id='body-input-event-edit-"+e+"-alert' class='event-edit-alert'>*Field required</p>"),setTimeout(function(){t.focus().parent().removeClass("ui-custom-event-edit-focus")},500),t.change(function(){$("#body-input-event-edit-"+e+"-alert").remove(),t.unbind("change")})};if(0==n.length)return void c("title");if(0==o.length)return void c("location");if(0==r.length)return void c("startTime");if(0==s.length)return void c("endTime");$("#body-bottom-edit-event-save").unbind("click");var l=r.indexOf(":"),u=r.lastIndexOf(":");l!=u&&(r=r.substring(0,u)),l=s.indexOf(":"),u=s.lastIndexOf(":"),l!=u&&(s=s.substring(0,u));var v=r+" -- "+s,m="on"==$("#body-select-edit-event-visibility").val(),p=$("#body-input-edit-event-description").val(),g=$("#body-edit-event-error"),f="#page-event-my-event",b=function(e){$("#body-input-edit-event-title").val(""),$("#body-input-edit-event-location").val(""),$("#event-edit-start-time").val(""),$("#event-edit-end-time").val(""),$("#body-input-edit-event-description").val(""),$("#body-select-edit-event-visibility").val("on").flipswitch("refresh"),$("#body-edit-event-error").html("");var t=e.id,i=buildMyUserEventElement(e),n=$("#body-my-event"+t);n.before(i),n.remove(),t=e.id;var o=e.get("owner");if(i=buildUserEventElement(e),n=$("#body-event"+t),n.before(i),n.remove(),pullUserEventHolderInfo(o,t),"undefined"==typeof e.get("goingId"))var r=[];else r=e.get("goingId");var s,a=e.get("title");a.length>10&&(a=a.slice(0,6)+"...");for(var d=0;d<r.length;d++)s=r[d],pushNotificationToDeviceByUserId(s,Parse.User.current().get("name")+" updated the activity '"+a+"'.")};ParseEventEditSave(i,n,o,v,a,d,m,p,g,f,b,e)}function shareEvents(e){var t="http://yuemeuni.tk/share.html?id="+e.id;console.log(window.location.href),console.log(t);var i=e.get("time").split(" -- ")[0],n=i.substring(0,i.indexOf(" ")),o=i.substring(i.indexOf(" ")+1,i.length),r="Please join us!\n\nEvent: "+e.get("title")+"\nDate: "+n+" \nTime: "+o;
r+="\nSee detail on this link:\n\n"+t;var s="mailto:?subject=There is a fantastic activity : "+e.get("title")+"&body="+encodeURI(r);$(".share-via-mail").attr("href",s);var a="Check out this event on Yueme:\n\n"+t,d="sms:";d+=deviceIsIOS&&8==deviceIOSVersion?"&":deviceIsIOS?";":"?",d+="body=",d+=encodeURI(a),$(".share-via-sms").attr("href",d)}var pullLastItem=0,currentLastEvent,imgArray=[],listenKeyup=!0,goingToDelete=!1,selectedElement="",animateDuration=150;