function getDeviceInfo(){devicePlatform=navigator.platform,deviceVersion=navigator.appVersion,deviceIsIOS="iPhone"==devicePlatform||"iPad"==devicePlatform||"iPod"==devicePlatform,deviceIsIOS&&(-1!=deviceVersion.indexOf("OS 8")?deviceIOSVersion=8:-1!=deviceVersion.indexOf("OS 7")?deviceIOSVersion=7:-1!=deviceVersion.indexOf("OS 6")?deviceIOSVersion=6:-1!=deviceVersion.indexOf("OS 5")?deviceIOSVersion=5:deviceIOSVersion=4)}function getUrlParameter(e){for(var t=window.location.search.substring(1),o=t.split("&"),i=0;i<o.length;i++){var n=o[i].split("=");if(n[0]==e)return n[1]}}function buildEventWithoutLogin(e){var t=e.get("title"),o=e.get("location"),i=e.get("time"),n=(e.get("visibility"),e.get("description")),r=e.get("commentNumber"),a=(e.get("owner"),e.get("goingId"));"undefined"==typeof a&&(a=[]);var s=a.length,c=e.get("interestId");"undefined"==typeof c&&(c=[]);var d=c.length,l=e.id,m="";return m=m+"<div id='body-event-detail-"+l+"'>",m+="<div class='custom-corners-public custom-corners'>",m+="<div class='ui-bar ui-bar-a' style='cursor:pointer' onclick=\"$.mobile.changePage('#page-display-user-profile');\">",m=m+"<div><strong id='body-top-bar-event-detail-"+l+"-owner-name'></strong></div>",m=m+"<div id='body-top-bar-event-detail-"+l+"-owner-gender' class='ui-icon-custom-gender'></div>",m+="</div>",m+="<div class='ui-body ui-body-a'>",m=m+"<p class='ui-custom-event-title'>"+t+"</p>",0==n.length?m+="<p class='ui-custom-event-description-less-margin'></br></p>":m=m+"<p class='ui-custom-event-description'>"+n.replace("\n","</br>")+"</p>",m=m+"<p class='ui-custom-event-location'>"+o+"</p>",m=m+"<p class='ui-custom-event-time'>"+i+"</p>",m=m+"<div class='event-statistics comment-statistics-"+l+"' style='clear:both'>"+r+" Comments</div><div class='event-statistics interest-statistics-"+l+"'>"+d+" Interests</div><div class='event-statistics going-statistics-"+l+"'>"+s+" Goings</div>",m+="</div>",m+="<div class='ui-footer ui-bar-custom'>",m+="<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-favor-false interest-button-"+l+"' onclick=''>Interest</a></div>",m=m+"<div class='ui-custom-float-left'><a href='#' class='ui-btn ui-bar-btn-custom ui-mini ui-icon-custom-going-false going-button-"+l+"' onclick=''>Going</a></div>",m+="</div>",m+="</div>",m+="</div>"}function pullEventDetailWithoutLogin(e){currentEarliestComment=new Date,$("#body-content-event-detail").html(""),$("#footer-bar-event-id-label").html(e);var t="createdAt",o=5,i=function(e){shareEvents(e[0]);var t=e[0].id,o=e[0].get("owner"),i=e[0].get("commentNumber"),n=buildEventWithoutLogin(e[0]);i>5&&(n+="<div class='ui-custom-earlier-comment-btn ui-btn' onclick='loadMoreEventComment()'><font style='font-weight:bold'>load more comments</font></div>"),$("#body-content-event-detail").prepend(n),pullUserEventHolderInfo(o,"detail-"+t),$(".report-btn").addClass("ui-hidden-accessible")};ParseSelectEvent(e,i),i=function(e){$("#body-content-event-detail").append("<div id='body-content-bottom-event-comments-list' class='ui-custom-comment-container'></div>");for(var t=0;t<=e.length-1;t++){Date.parse(currentEarliestComment)>Date.parse(e[t].createdAt)&&(currentEarliestComment=e[t].createdAt);var o=buildCommentInEventDetail(e[t]);$("#body-content-bottom-event-comments-list").prepend(o);var i=function(e,t){var o=e.get("profilePhoto120");"undefined"==typeof o&&(o="./content/png/Taylor-Swift.png"),$("#comment-"+t.commentId).css("backgroundImage","url("+o+")")};CacheGetProfilePhotoByUserId(e[t].get("owner"),i,{commentId:e[t].id})}},ParsePullEventComment({eventId:e,descendingOrderKey:t,limitNumber:o,displayFunction:i})}function initialElementEventSetting(){var e=$("#footer-bar-input-comment-content");e.on("blur",function(){e.prop("disabled",!0),$("#footer-bar-send-comment").css("position","fixed").css("bottom","0"),0==e.val().length&&($("#footer-bar-input-comment-content").attr("placeholder","comment..."),$("#footer-bar-reply-to-id-label").html(""))}),e.prop("disabled",!0),$("#footer-bar-form-comment").submit(function(e){e.preventDefault()}),$("#body-form-login").submit(function(e){e.preventDefault()}),$("#body-form-signup").submit(function(e){e.preventDefault()}),$(document).on("pageshow","#page-event-detail",function(){$("#footer-bar-send-comment").css("position","fixed").css("bottom","0").show()}),$(document).on("pagebeforehide","#page-event-detail",function(){$("#footer-bar-send-comment").hide()})}function convertTime(e){var t=6e4,o=60*t,i=24*o,n=30*i,r=365*i,a=new Date,s=a.getTime()-Date.parse(e.toString());s=Math.max(s,0);var c=Math.floor(s/r);s-=r*c;var d=Math.floor(s/n);s-=n*d;var l=Math.floor(s/i);s-=i*l;var m=Math.floor(s/o);s-=o*m;var u=Math.floor(s/t),v="";return v=c>0?c.toString()+(c>1?" years ago":" year ago"):d>0?d.toString()+(d>1?" months ago":" month ago"):l>0?l.toString()+(l>1?" days ago":" day ago"):m>0?m.toString()+(m>1?" hours ago":" hour ago"):u>0?u.toString()+(u>1?" mins ago":" min ago"):"just now"}function sendToolbarActiveKeyboard(e){$("html body").animate({scrollTop:$(document).height().toString()+"px"},{duration:300,complete:function(){$(e.id).prop("disabled",!1),$(e.bar).css("position","absolute"),$(e.bar).css("bottom",($("body").height()-$(e.base).height()+e.bias).toString()+"px"),$(e.id).trigger("focus")}})}$(document).ready(function(){initialElementEventSetting(),cacheInitialization(),getDeviceInfo();var e=getUrlParameter("id"),t=Parse.User.current();t?(updateEventDetail(e),$("#footer-bar-send-comment").css("position","fixed").css("bottom","0").show()):pullEventDetailWithoutLogin(e)});